@(stage: String, estate: model.Estate, totalSunkCost: Float)(implicit request: play.api.mvc.Security.AuthenticatedRequest[_, User], money: java.text.DecimalFormat)

@import model._

@main("Status Monitor", stage=Some(stage), refreshSecs = None, scripts = List("assets/js/graph.js", "assets/js/settings.js")) {

    <script type="text/jsx" src="@routes.Assets.at("components/asg.js")">
    </script>
    <div id="asg"></div>

    <div data-spy="affix" data-offset-top="150" class="settings">
        <button type="button" class="btn btn-default glyphicon glyphicon-wrench pull-left"
        data-toggle="modal" data-target="#config"></button>
    </div>
    <div class="container cluster-status">
        <div class="row queues">
            <div class="col-sm-12">
            <ul class="list-group">
            @for(queue <- estate.queues) {
                <li id="@queue.name" class="list-group-item list-group-item-condensed queue"
                    data-ajax-refresh="/queue/@queue.name"></li>
            }
            </ul>
            </div>
        </div>

        <div class="row">
        @for(column <- estate(stage).grouped(math.max(estate(stage).size / 3, 1))) {
            <div class="col-lg-4 hidden-md">
            @for(asg <- column) {
                <div id="@{asg.name}" class="panel panel-default" style="overflow: hidden">
                    <script type="text/jsx">
                        /** @@jsx React.DOM */
                        React.renderComponent(
                            <AutoScalingGroup name="@{asg.name}" />,
                            document.getElementById('@{asg.name}')
                        );
                    </script>
                </div>
            }
            </div>
        }
        @for(column <- estate(stage).grouped(math.max(estate(stage).size / 2, 1))) {
            <div class="col-md-6 visible-md">
            @for(asg <- column) {
                <div data-ajax-refresh="/asg/@asg.name" class="panel panel-default" style="overflow: hidden"></div>
            }
            </div>
        }
        </div>
        <div class="row">
            <div class="well">
                Approximate total monthly cost for all ASGs: $@money.format(estate(stage).map(_.approxMonthlyCost).sum)
                @if(estate.size > 1) {
                  (for all stages: $@money.format(estate.values.flatMap(_.map(_.approxMonthlyCost)).sum))
                }
                @if(totalSunkCost > 0) { (total sunk cost: $@money.format(totalSunkCost)) }
            </div>
        </div>

    </div>

    <div class="modal fade" id="config" tabindex="-1" role="dialog" aria-labelledby="configLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="configLabel">Queues to show</h4>
                </div>
                <div class="modal-body">
                    <a href="#" id="all-queues">All</a> | <a href="#" id="no-queues">None</a>
                    @for(queue <- estate.queues) {
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" value="@queue.name" checked>
                                @queue.name
                            </label>
                        </div>
                    }
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" id="save-setttings" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <script>var interval = 15000</script>
    <script src="assets/js/auto-refresh.js" type="text/javascript"></script>
}